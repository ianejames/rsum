#!/usr/bin/env bash

# This file generates a recursive hash of a directory.

set -o nounset
set -o errexit
set -o pipefail
# set -o xtrace

# Global variables.

declare -a ROOTPATHS=()

function parse_options() {
  while (( "$#" )); do
    case "$1" in
      --) # end argument parsing
        shift
        break
        ;;
      -*|--*=) # unsupported flags
        echo "Error: Unsupported flag $1" >&2
        exit 1
        ;;
      *) # preserve positional arguments
        ROOTPATHS+=("$1")
        shift
        ;;
    esac
  done

  ROOTPATHS+=("$@")
}

function main() {
  parse_options "$@"

  if [ "${#ROOTPATHS[@]}" -eq 0 ]; then
    return 0;
  fi

  pwd=$(pwd)

  for rootpath in "${ROOTPATHS[@]}"; do
    cd "$rootpath"

    find . -type f -exec shasum {} + | sort -k 2

    cd "$pwd"
  done
}

main "$@"
